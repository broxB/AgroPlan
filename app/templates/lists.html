{% extends "base.html" %}
{% from "utils.html" import render_field %}

{% block app_content %}
  <div class="container-fluid">
    <form action="" method="post">
      {{ render_field(form.csrf_token) }}
      <div class="row">
        <div class="col-xxl-3 col-xl-4 col-lg-5 col-md-6 col-sm-12">{{ render_field(form.list_type) }}</div>
        <div class="col-xxl-3 col-xl-4 col-lg-5 col-md-6 col-sm-12">{{ render_field(form.item_type) }}</div>
        <div class="col-xxl-3 col-xl-4 col-lg-5 col-md-6 col-sm-12">{{ render_field(form.year) }}</div>
      </div>

      <div class="row">
        <div class="col-xxl-3 col-md-4 col-sm-12">
          <div class="row">
            {{ render_field(form.fields) }}
            <div class="col">
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="selectAll(document.querySelector('#fields'))">All</button>
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="deselectAll(document.querySelector('#fields'))">None</button>
            </div>
          </div>
        </div>
        <div class="col-xxl-3 col-md-4 col-sm-12">
          <div class="row">
            {{ render_field(form.crops) }}
            <div class="col">
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="selectAll(document.querySelector('#crops'))">All</button>
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="deselectAll(document.querySelector('#crops'))">None</button>
            </div>
          </div>
        </div>
        <div class="col-xxl-3 col-md-4 col-sm-12">
          <div class="row">
            {{ render_field(form.fertilizers) }}
            <div class="col">
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="selectAll(document.querySelector('#fertilizers'))">All</button>
              <button class="btn btn-sm btn-primary"
                      type="button"
                      onclick="deselectAll(document.querySelector('#fertilizers'))">None</button>
            </div>
          </div>
        </div>
      </div>

      <div class="row pt-2">
        <div class="col">{{ render_field(form.submit) }}</div>
      </div>
    </form>
  </div>

  {% if lists %}
    <div class="container-fluid">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Field</th>
            <th scope="col">Ha</th>
            <th scope="col">Crop</th>
            <th scope="col">Fertilizer</th>
            <th scope="col">Measure</th>
            <th scope="col">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for fertilization in lists %}
            <tr>
              <th scope="row">{{ loop.index }}</th>
              <td>
                <a class="text-reset text-decoration-none"
                   href="{{ url_for('main.field', id=fertilization.field.id) }}">
                  {{ "{prefix:02}-{suffix} {name}".format(prefix=fertilization.field.base_field.prefix, suffix=fertilization.field.base_field.suffix, name=fertilization.field.base_field.name) }}
                </a>
              </td>
              <td>{{ fertilization.field.area }}</td>
              <td>{{ fertilization.cultivation.crop.name }}</td>
              <td>{{ fertilization.fertilizer.name }}</td>
              <td>{{ fertilization.measure }}</td>
              <td>{{ "{amount} {unit}".format(amount=fertilization.amount, unit=fertilization.fertilizer.unit) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  {% endif %}

  <script>
  function selectAll(selectField){
    for (let option of selectField.options) {
      option.setAttribute('selected', "")
    }
  }

  function deselectAll(selectField){
    for (let option of selectField.options) {
      option.removeAttribute('selected')
    }
  }

  const selectFields = document.querySelectorAll("form select[multiple]")
  for (let select of selectFields) {
    for (let option of select.options)
    option.addEventListener("click", (e) => {
      e.preventDefault();
      e.currentTarget.toggleAttribute("selected")
    })
  }
  </script>
{% endblock app_content %}
